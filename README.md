# 流程图编辑器：使用手册和技术手册

![图片2](pic.png)

## 功能介绍

### 按键

| 按键                | 功能            |
|-------------------|---------------|
| alt + 鼠标滚轮 / 鼠标滚轮 | 左右 / 竖直平移     |
| ctrl + 鼠标滚轮       | 缩放            |
| 选中+page up/down   | 选中元素上移一层/下移一层 |
| 选中+delete         | 删除选中元素        |

### 工具

目前实现了5个工具，分别是：

- 选择工具：可以选中元素，选中后可以拖动/调整元素
- 连接工具：选中一个点按住并拖动到另一个点，如果连接到图形，则会和图形绑定，否则就是自由的线
- 多边形/线工具：左键点击画布添加点，右键结束绘制。通过设置Property可以改变它为多边形或线。
- 矩形工具：按住并拖动进行绘制。通过设置Property为其添加图片。
- 椭圆工具：按住并拖动进行绘制。

### 属性

程序右侧的属性栏可以设置当前选中元素的属性，主要有以下默认几项：

- 填充颜色（fill_color）：设置元素的颜色
- 边框颜色（border_color）：设置元素的边框颜色
- 边框宽度（border_width）：设置元素的边框宽度
- 封闭（closed）：设置元素是否封闭
- 文字（text）：设置元素上显示的文字
- 文字颜色（text_color）：设置元素上文字的颜色
- 文字大小（text_size）：设置元素上文字的大小

### 其它功能

在程序的顶部菜单栏

- 保存
- 打开
- 新建
- 导出

## 代码设计介绍

![流程图](流程图.png)

### 项目结构

```angular2html
root
├── cmake-build-release-visual-studio (编译产物，二进制文件/bin)
├── CMakeLists.txt
├── README.md
├── thirdparty_install (依赖库，这个没有传上来)
└── src
    ├─Convertor [转换器]
    ├─DataModels [数据模型]
    ├─FEPlugins [插件]
    │  ├─ClassicLink - 连线工具
    │  ├─PathBrokenLine - 折线/多边形工具
    │  ├─ShapeCircle - 椭圆工具
    │  ├─ShapeRect - 矩形工具
    │  └─ShapeSmile - 笑脸工具
    ├─GraphicsComponents [画板组件]
    ├─IPlugin [插件接口]
    ├─Main [主程序]
    └─Utils [工具类]
```

### 代码设计

**插件化设计，支持动态加载插件，自动注册工具。可以很方便的添加新的图元。提供了默认的图元实现，拓展时只需要重写少量代码即可。**

如果要添加新的工具：

1. 继承IPlugin接口。
2. 继承CanvasElement来实现自己的图元类（最简单仅需重写constructShape函数即可）

导出为dll，放到程序运行目录下的plugins中。
具体可以参考FEPlugins目录中的项目。也可以直接在FEPlugins目录中复制并添加新的项目。cmakelist是调整好了的。

图元构造时，设置为不同的type，程序会有不同的处理逻辑，分为以下几类工具：

- PATH - 折线/多边形工具
    - 每次通过左键点击添加点，右键结束绘制。被选中时，不会出现调整框，而是出现调整点
- SHAPE - 形状工具
    - 按住并拖动进行绘制，释放时创建最终图元。被选中时出现调整框。
- LINK - 连线工具
    - 会自动开启吸附点，当出现吸附点时，按下/松开会绑定到吸附点及其父元素。被选中时，和折线工具的逻辑一样。（这意味着同样可以添加多个点）

每个图元都有以下数据：

- pluginName - 插件名称
- type - 图元类型
- points - 基本数据点
- selfLinkPoints - 自身绑定点（这里添加的点，就由“你”来管理。）
- obverseLinkPoints - 其它图元绑定到你身上的点（即这些点，“你”没有它的所有权，你可以修改，但是当对方删除该点时，你也会自动失去）

最终序列化也是基于点来存储的。因此，在实现绘制时，需要基于“点”来绘制。CanvasElement的默认实现就是以点来绘制的。